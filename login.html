<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Work Manager</title>
    <link rel="stylesheet" href="login.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo-container">
                    <img src="images/logo workyz.png" alt="Work Manager Logo" class="logo-image">
                </div>
                <p>Acesso Restrito</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="loginUsuario">
                        <i class="fas fa-user"></i> Nome de Usuário
                    </label>
                    <input type="text" id="loginUsuario" required placeholder="Seu nome de usuário" autocomplete="username">
                </div>

                <div class="form-group">
                    <label for="loginPassword">
                        <i class="fas fa-lock"></i> Senha
                    </label>
                    <input type="password" id="loginPassword" required placeholder="Sua senha" autocomplete="current-password">
                </div>

                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" id="rememberMe">
                        <span class="checkmark"></span>
                        Lembrar-me
                    </label>
                </div>

                <button type="submit" class="btn-login" id="btnLogin">
                    <i class="fas fa-sign-in-alt"></i>
                    <span id="btnText">Entrar no Sistema</span>
                    <div class="spinner hidden" id="spinner"></div>
                </button>

                <div class="login-footer">
                    <p><i class="fas fa-shield-alt"></i> Sistema seguro - Acesso monitorado</p>
                </div>
            </form>
        </div>

        <div class="login-background">
            <div class="background-shapes">
                <div class="shape shape-1"></div>
                <div class="shape shape-2"></div>
                <div class="shape shape-3"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK v12 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { 
            getFirestore, 
            doc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCJpyAouZtwoWC0QDmTtpJxn0_j_w8DlvU",
            authDomain: "logins-c3407.firebaseapp.com",
            projectId: "logins-c3407",
            storageBucket: "logins-c3407.firebasestorage.app",
            messagingSenderId: "809861558230",
            appId: "1:809861558230:web:e6e41bf1db9b3cfd887e77"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        window.firebaseApp = {
            db,
            firebaseModules: {
                doc,
                getDoc
            }
        };
    </script>

    <!-- login.js INLINE - EXCLUSIVO PARA LOGINS_ORGTAREFAS -->
    <script>
        async function fazerLogin(usuario, senha) {
            const btnLogin = document.getElementById('btnLogin');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            
            try {
                if (!usuario || !senha) {
                    alert('Preencha usuário e senha');
                    return;
                }

                btnLogin.disabled = true;
                btnText.textContent = 'Autenticando...';
                spinner.classList.remove('hidden');
                
                const { db, firebaseModules } = window.firebaseApp;
                const { doc, getDoc } = firebaseModules;
                
                const docRef = doc(db, 'logins', 'LOGINS_ORGTAREFAS');
                const docSnap = await getDoc(docRef);
                
                if (!docSnap.exists()) {
                    throw new Error('Documento LOGINS_ORGTAREFAS não encontrado!');
                }
                
                const dadosCompletos = docSnap.data();
                
                let usuarioEncontrado = null;
                let userId = null;
                
                const todosCampos = Object.keys(dadosCompletos);
                
                for (let i = 1; i <= 50; i++) {
                    const possiveisLogins = [
                        `login_${i}`,
                        `usuario_${i}`,
                        `user_${i}_login`,
                        `user_${i}_usuario`
                    ];
                    
                    for (const campoLogin of possiveisLogins) {
                        if (dadosCompletos[campoLogin] === usuario) {
                            const campoSenha = encontrarCampoSenha(dadosCompletos, i);
                            const campoNome = encontrarCampoNome(dadosCompletos, i);
                            const campoPerfil = encontrarCampoPerfil(dadosCompletos, i);
                            const campoStatus = encontrarCampoStatus(dadosCompletos, i);
                            
                            usuarioEncontrado = {
                                login: dadosCompletos[campoLogin],
                                senha: campoSenha ? dadosCompletos[campoSenha] : null,
                                nome: campoNome ? dadosCompletos[campoNome] : null,
                                perfil: campoPerfil ? dadosCompletos[campoPerfil] : null,
                                status: campoStatus ? dadosCompletos[campoStatus] : 'ativo'
                            };
                            userId = `user_${i}`;
                            break;
                        }
                    }
                    if (usuarioEncontrado) break;
                }
                
                if (!usuarioEncontrado) {
                    for (const campo of todosCampos) {
                        const valor = dadosCompletos[campo];
                        if (valor && typeof valor === 'object') {
                            if (valor.login === usuario || valor.usuario === usuario) {
                                usuarioEncontrado = valor;
                                userId = campo;
                                break;
                            }
                        }
                    }
                }
                
                if (!usuarioEncontrado) {
                    throw new Error('Usuário não encontrado');
                }
                
                if (!usuarioEncontrado.senha) {
                    throw new Error('Campo de senha não encontrado');
                }
                
                if (usuarioEncontrado.senha !== senha) {
                    throw new Error('Senha incorreta');
                }
                
                const usuarioLogado = {
                    id: userId,
                    uid: userId,
                    usuario: usuarioEncontrado.login || usuario,
                    nome: usuarioEncontrado.nome || 
                         usuarioEncontrado.displayName || 
                         usuarioEncontrado.name || 
                         usuario,
                    perfil: usuarioEncontrado.perfil || 
                           usuarioEncontrado.nivel || 
                           usuarioEncontrado.profile || 
                           'usuario',
                    email: usuarioEncontrado.email || '',
                    status: usuarioEncontrado.status || 'ativo',
                    isOnline: usuarioEncontrado.isOnline || false,
                    documento: 'LOGINS_ORGTAREFAS',
                    dataLogin: new Date().toISOString()
                };
                
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                
                const rememberMe = document.getElementById('rememberMe').checked;
                if (rememberMe) {
                    localStorage.setItem('savedUser', usuario);
                } else {
                    localStorage.removeItem('savedUser');
                }
                
                btnText.textContent = 'Redirecionando...';
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 500);
                
            } catch (error) {
                console.error('Erro no login:', error);
                alert('Erro: ' + error.message);
                
                btnLogin.disabled = false;
                btnText.textContent = 'Entrar no Sistema';
                spinner.classList.add('hidden');
            }
        }

        function encontrarCampoSenha(dados, numero) {
            const possiveis = [
                `senha_${numero}`,
                `password_${numero}`,
                `user_${numero}_senha`,
                `user_${numero}_password`
            ];
            return possiveis.find(campo => campo in dados);
        }
        
        function encontrarCampoNome(dados, numero) {
            const possiveis = [
                `nome_${numero}`,
                `name_${numero}`,
                `displayName_${numero}`,
                `user_${numero}_nome`,
                `user_${numero}_name`,
                `user_${numero}_displayName`
            ];
            return possiveis.find(campo => campo in dados);
        }
        
        function encontrarCampoPerfil(dados, numero) {
            const possiveis = [
                `perfil_${numero}`,
                `profile_${numero}`,
                `nivel_${numero}`,
                `role_${numero}`,
                `user_${numero}_perfil`,
                `user_${numero}_profile`,
                `user_${numero}_nivel`,
                `user_${numero}_role`
            ];
            return possiveis.find(campo => campo in dados);
        }
        
        function encontrarCampoStatus(dados, numero) {
            const possiveis = [
                `status_${numero}`,
                `ativo_${numero}`,
                `user_${numero}_status`,
                `user_${numero}_ativo`
            ];
            return possiveis.find(campo => campo in dados);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('loginForm');
            const usuarioInput = document.getElementById('loginUsuario');
            const senhaInput = document.getElementById('loginPassword');
            
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const usuario = usuarioInput.value.trim();
                    const senha = senhaInput.value;
                    fazerLogin(usuario, senha);
                });
            }
            
            usuarioInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    senhaInput.focus();
                }
            });
            
            senhaInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    form.dispatchEvent(new Event('submit'));
                }
            });
            
            const savedUser = localStorage.getItem('savedUser');
            if (savedUser) {
                usuarioInput.value = savedUser;
                document.getElementById('rememberMe').checked = true;
                senhaInput.focus();
            } else {
                usuarioInput.focus();
            }
        });
    </script>
</body>
</html>
