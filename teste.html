<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Workyz</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos espec√≠ficos para a p√°gina de teste */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .teste-corpo {
            background: white;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-size: 1.5rem;
            color: #2c3e50;
            border-top: 4px solid #3498db;
        }
        
        .teste-corpo i {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 20px;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Tela de Carregamento (igual ao index.html) -->
    <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div style="text-align: center;">
            <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: #0078d4; margin-bottom: 20px;"></i>
            <p id="loadingText">Verificando autentica√ß√£o...</p>
        </div>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <!-- CABE√áALHO PROFISSIONAL (EXATAMENTE IGUAL AO INDEX.HTML) -->
        <header class="home-header">
            <div class="header-full">
                <!-- Logo √† esquerda -->
                <div class="logo-container">
                    <img src="images/logo workyz.png" alt="Work Manager" class="site-logo">
                </div>
                
                <!-- Todos os itens organizados √† direita -->
                <div class="header-right">
                    <!-- Bot√µes de navega√ß√£o -->
                    <div class="header-actions">
                        <button class="btn-header" onclick="window.location.href='chat.html'">
                            <i class="fas fa-comment-dots"></i> Chat
                        </button>
                        <button class="btn-header" onclick="window.location.href='dashboard.html'">
                            <i class="fas fa-chart-line"></i> Minhas Atividades
                        </button>
                        <button class="btn-header" onclick="window.location.href='workmanager.html'">
                            <i class="fas fa-users"></i> Grupos de Trabalho
                        </button>
                    </div>
                    
                    <!-- Status e informa√ß√µes do usu√°rio -->
                    <div class="header-status">
                        <!-- Container para os sinos lado a lado -->
                        <div class="alert-bells-container">
                            <!-- SINO 1: ALERTAS DE OBSERVADOR (MUDAN√áAS DE STATUS) -->
                            <div class="alerts-container" id="observadorAlertsContainer">
                                <button class="alert-bell observador-bell" id="observadorBell" onclick="abrirAlertasObservador()">
                                    <i class="fas fa-eye"></i>
                                    <span class="alert-count" id="observadorAlertCount" style="display: none;">0</span>
                                </button>
                                <div class="alert-dropdown" id="observadorAlertDropdown">
                                    <div class="alert-dropdown-header">
                                        <h4><i class="fas fa-eye"></i> Alerta de Atividades Observadas</h4>
                                    </div>
                                    <div class="alert-dropdown-content" id="observadorAlertList">
                                        <div class="no-alerts">Nenhum alerta</div>
                                    </div>
                                </div>
                            </div>
                            <!-- SINO 2: ALERTAS DE PENDENTE PARA O RESPONS√ÅVEL -->
                            <div class="alerts-container" id="responsavelAlertsContainer">
                                <button class="alert-bell responsavel-bell" id="responsavelBell" onclick="abrirAlertasResponsavel()">
                                    <i class="fas fa-bell"></i>
                                    <span class="alert-count" id="responsavelAlertCount" style="display: none;">0</span>
                                </button>
                                <div class="alert-dropdown" id="responsavelAlertDropdown">
                                    <div class="alert-dropdown-header">
                                        <h4><i class="fas fa-bell"></i> Alertas de Atividades Pendentes</h4>
                                    </div>
                                    <div class="alert-dropdown-content" id="responsavelAlertList">
                                        <div class="no-alerts">Nenhuma pend√™ncia</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status de conex√£o -->
                        <span class="status-sync" id="status-sincronizacao">
                            <i class="fas fa-bolt"></i> Conectado
                        </span>
                        
                        <!-- Informa√ß√µes do usu√°rio logado -->
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="user-details">
                                <span id="userName" class="username">Carregando...</span>
                                <button class="btn-logout" onclick="logout()" title="Sair">
                                    <i class="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </header>

        <!-- Corpo da p√°gina de teste (simples como solicitado) -->
        <div class="teste-corpo">
            <i class="fas fa-flask"></i>
            Teste corpo
        </div>
    </div>

    <!-- Firebase SDK (os mesmos scripts do index.html) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Script de teste com alertas REAIS -->
    <script>
        // ====== FUN√á√ïES ESPEC√çFICAS PARA TESTE.HTML ======
        // Estado global dos alertas
        let alertasObservador = [];
        let alertasResponsavel = [];
        
        // Inicializa√ß√£o da p√°gina de teste
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Inicializando p√°gina de teste com dados REAIS...');
            document.getElementById('loadingText').textContent = 'Verificando autentica√ß√£o...';
            
            // Verificar se usu√°rio est√° logado
            const usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado'));
            
            if (!usuarioLogado) {
                console.log('‚ùå Usu√°rio n√£o logado, redirecionando...');
                window.location.href = 'login.html';
                return;
            }

            console.log('üë§ Usu√°rio logado:', usuarioLogado.nome);
            document.getElementById('userName').textContent = usuarioLogado.nome;

            // Inicializar bancos Firebase
            await inicializarBancosFirebase();
            
            // Inicializar o sistema
            await inicializarSistemaTeste(usuarioLogado);
        });
        
        // Fun√ß√£o para inicializar bancos Firebase (igual ao script.js)
        async function inicializarBancosFirebase() {
            try {
                console.log('‚ö° Inicializando DOIS bancos Firebase...');
                
                // Banco 1: ORGTAREFAS
                const firebaseConfigOrgtarefas = {
                    apiKey: "AIzaSyAs0Ke4IBfBWDrfH0AXaOhCEjtfpPtR_Vg",
                    authDomain: "orgtarefas-85358.firebaseapp.com",
                    projectId: "orgtarefas-85358",
                    storageBucket: "orgtarefas-85358.firebasestorage.app",
                    messagingSenderId: "1023569488575",
                    appId: "1:1023569488575:web:18f9e201115a1a92ccb40a"
                };
                
                // Inicializar primeiro app
                const appOrgtarefas = firebase.initializeApp(firebaseConfigOrgtarefas);
                window.db = appOrgtarefas.firestore();
                console.log('‚úÖ Banco ORGTAREFAS inicializado!');
                
                // Banco 2: LOGINS
                const firebaseConfigLogins = {
                    apiKey: "AIzaSyCJpyAouZtwoWC0QDmTtpJxn0_j_w8DlvU",
                    authDomain: "logins-c3407.firebaseapp.com",
                    projectId: "logins-c3407",
                    storageBucket: "logins-c3407.firebasestorage.app",
                    messagingSenderId: "809861558230",
                    appId: "1:809861558230:web:e6e41bf1db9b3cfd887e77"
                };
                
                try {
                    const appLogins = firebase.initializeApp(firebaseConfigLogins, "LoginsApp");
                    window.dbLogins = appLogins.firestore();
                    console.log('‚úÖ Banco LOGINS inicializado!');
                } catch (error) {
                    if (error.code === 'app/duplicate-app') {
                        window.dbLogins = firebase.app("LoginsApp").firestore();
                    } else {
                        throw error;
                    }
                }
                
                console.log('üéØ Ambos os bancos configurados!');
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro ao configurar bancos:', error);
                return false;
            }
        }
        
        // Fun√ß√£o para inicializar sistema de teste
        async function inicializarSistemaTeste(usuarioLogado) {
            console.log('üìã Inicializando sistema de teste...');
            document.getElementById('loadingText').textContent = 'Conectando aos bancos de dados...';
            
            if (!window.db) {
                console.error('‚ùå Banco ORGTAREFAS n√£o foi inicializado!');
                mostrarErroTeste('Erro ao conectar com o banco de dados');
                return;
            }
            
            // Mostrar conte√∫do
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('status-sincronizacao').innerHTML = '<i class="fas fa-bolt"></i> Conectado';
            
            // Configurar listener para mudan√ßas em tempo real
            configurarListenerFirebaseTeste(usuarioLogado.usuario);
            
            // Fazer verifica√ß√£o inicial de alertas
            setTimeout(() => {
                console.log('üöÄ Iniciando verifica√ß√£o de alertas REAIS');
                verificarAlertasReais(usuarioLogado.usuario);
            }, 1000);
        }
        
        // Fun√ß√£o para configurar listener do Firebase
        function configurarListenerFirebaseTeste(usuarioAtual) {
            console.log('üì° Configurando listener do Firestore para alertas...');
            
            // Listener em tempo real para atividades (apenas para alertas)
            window.db.collection("atividades").onSnapshot(
                async (snapshot) => {
                    console.log('üîÑ Dados de atividades atualizados:', snapshot.size, 'documentos');
                    
                    // Verificar alertas quando atividades mudam
                    await verificarAlertasReais(usuarioAtual);
                },
                (error) => {
                    console.error('‚ùå Erro no Firestore:', error);
                    document.getElementById('status-sincronizacao').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Erro Conex√£o';
                }
            );
        }
        
        // ====== FUN√á√ïES DE ALERTAS COM DADOS REAIS ======
        
        // Fun√ß√£o principal para verificar alertas REAIS
        async function verificarAlertasReais(usuarioAtual) {
            try {
                console.log('üîî Verificando alertas REAIS para:', usuarioAtual);
                
                // Verificar alertas de observador (DADOS REAIS)
                await verificarAlertasObservadorReais(usuarioAtual);
                
                // Verificar alertas de respons√°vel (DADOS REAIS)
                await verificarAlertasResponsavelReais(usuarioAtual);
                
                // Atualizar contadores
                atualizarContadoresAlertas();
                
                console.log(`üìä Alertas estado: ${alertasObservador.length} observador, ${alertasResponsavel.length} respons√°vel`);
                
            } catch (error) {
                console.error('‚ùå Erro ao verificar alertas REAIS:', error);
            }
        }
        
        // Fun√ß√£o para verificar alertas de observador (DADOS REAIS)
        async function verificarAlertasObservadorReais(usuarioAtual) {
            try {
                console.log(`üîç Buscando alertas REAIS de observador para: ${usuarioAtual}`);
                
                // Buscar atividades onde o usu√°rio √© observador COM asterisco
                const snapshot = await window.db.collection('atividades')
                    .where('observadores', 'array-contains', usuarioAtual + '*')
                    .get();
                
                console.log(`üìä Atividades com asterisco: ${snapshot.docs.length}`);
                
                const atividades = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Filtrar atividades onde status √© diferente de statusAnterior
                const atividadesComAlerta = atividades.filter(atividade => {
                    const status = atividade.status || 'nao_iniciado';
                    const statusAnterior = atividade.statusAnterior || 'nao_iniciado';
                    
                    return status !== statusAnterior;
                });
                
                console.log(`‚ö†Ô∏è ${atividadesComAlerta.length} atividades com alertas n√£o vistos`);
                
                // Limpar alertas anteriores
                alertasObservador = [];
                
                // Criar alertas REAIS para cada atividade
                for (const atividade of atividadesComAlerta) {
                    // Buscar nome da tarefa no Firestore
                    let tarefaNome = 'Tarefa desconhecida';
                    try {
                        const tarefaDoc = await window.db.collection('tarefas').doc(atividade.tarefaId).get();
                        if (tarefaDoc.exists) {
                            tarefaNome = tarefaDoc.data().titulo || 'Tarefa desconhecida';
                        }
                    } catch (error) {
                        console.error('Erro ao buscar tarefa:', error);
                    }
                    
                    const statusAnterior = atividade.statusAnterior || 'nao_iniciado';
                    const statusAtual = atividade.status || 'nao_iniciado';
                    
                    const alertaId = `obs_${atividade.id}_${statusAtual}_${Date.now()}`;
                    
                    const alerta = {
                        id: alertaId,
                        atividadeId: atividade.id,
                        titulo: atividade.titulo || 'Atividade sem t√≠tulo',
                        statusAntigo: statusAnterior,
                        statusNovo: statusAtual,
                        dataAlteracao: atividade.dataAtualizacao ? 
                            atividade.dataAtualizacao.toDate() : new Date(),
                        tarefaNome: tarefaNome,
                        tipo: 'observador',
                        descricao: atividade.descricao || '',
                        responsavel: atividade.responsavel || '',
                        observador: usuarioAtual
                    };
                    
                    alertasObservador.push(alerta);
                    console.log(`‚úÖ Alerta REAL criado: ${alerta.titulo} (${statusAnterior} ‚Üí ${statusAtual})`);
                }
                
                // Atualizar interface
                atualizarContadoresAlertas();

            } catch (error) {
                console.error('‚ùå Erro em alertas de observador REAIS:', error);
            }
        }
        
        // Fun√ß√£o para verificar alertas de respons√°vel (DADOS REAIS)
        async function verificarAlertasResponsavelReais(usuarioAtual) {
            try {
                console.log(`üîç Buscando alertas REAIS de respons√°vel para: ${usuarioAtual}`);
                
                // Buscar atividades onde o usu√°rio √© respons√°vel E status √© pendente
                const snapshot = await window.db.collection('atividades')
                    .where('responsavel', '==', usuarioAtual)
                    .where('status', '==', 'pendente')
                    .get();
                
                console.log(`‚è∞ Atividades pendentes REAIS: ${snapshot.docs.length}`);
                
                // Atualizar array de alertas
                alertasResponsavel = snapshot.docs.map(doc => {
                    const atividade = doc.data();
                    const alertaId = `resp_${doc.id}`;
                    
                    // Buscar nome da tarefa
                    let tarefaNome = 'Tarefa desconhecida';
                    
                    return {
                        id: alertaId,
                        atividadeId: doc.id,
                        titulo: atividade.titulo || 'Atividade sem t√≠tulo',
                        status: 'pendente',
                        dataCriacao: new Date(),
                        tarefaNome: tarefaNome,
                        tipo: 'responsavel',
                        dataPrevista: atividade.dataPrevista,
                        descricao: atividade.descricao || '',
                        responsavel: atividade.responsavel || 'N√£o definido'
                    };
                });
                
            } catch (error) {
                console.error('‚ùå Erro ao verificar alertas de respons√°vel REAIS:', error);
            }
        }
        
        // ====== FUN√á√ïES DE INTERFACE ======
        
        // Fun√ß√£o para atualizar contadores de alertas
        function atualizarContadoresAlertas() {
            // Para observador: todos os alertas na lista s√£o n√£o lidos
            const naoLidosObservador = alertasObservador.length;
            
            // Para respons√°vel: todos os alertas na lista s√£o n√£o lidos
            const naoLidosResponsavel = alertasResponsavel.length;
            
            // Obter elementos DOM
            const observadorCountEl = document.getElementById('observadorAlertCount');
            const responsavelCountEl = document.getElementById('responsavelAlertCount');
            
            // Verificar se elementos existem antes de atualizar
            if (observadorCountEl) {
                observadorCountEl.textContent = naoLidosObservador;
                observadorCountEl.style.display = naoLidosObservador > 0 ? 'flex' : 'none';
            }
            
            if (responsavelCountEl) {
                responsavelCountEl.textContent = naoLidosResponsavel;
                responsavelCountEl.style.display = naoLidosResponsavel > 0 ? 'flex' : 'none';
            }
            
            console.log('‚úÖ Contadores atualizados:', { observador: naoLidosObservador, responsavel: naoLidosResponsavel });
        }
        
        // Fun√ß√£o para abrir dropdown de alertas de observador
        function abrirAlertasObservador() {
            const container = document.getElementById('observadorAlertsContainer');
            const otherContainers = document.querySelectorAll('.alerts-container.show');
            
            // Fechar outros dropdowns
            otherContainers.forEach(other => {
                if (other !== container) {
                    other.classList.remove('show');
                }
            });
            
            // Alternar este dropdown
            container.classList.toggle('show');
            
            // Renderizar alertas REAIS
            renderizarAlertasObservador();
        }
        
        // Fun√ß√£o para renderizar alertas de observador
        function renderizarAlertasObservador() {
            const container = document.getElementById('observadorAlertList');
            
            if (alertasObservador.length === 0) {
                container.innerHTML = '<div class="no-alerts">Nenhum alerta n√£o visualizado</div>';
                return;
            }
            
            // Ordenar do mais recente para o mais antigo
            const alertasOrdenados = [...alertasObservador].sort((a, b) => 
                new Date(b.dataAlteracao) - new Date(a.dataAlteracao)
            );
            
            const alertasHTML = alertasOrdenados.map(alerta => {
                const tempoAtras = formatarTempoAtras(alerta.dataAlteracao);
                
                return `
                    <div class="alert-item unread" data-alerta-id="${alerta.id}">
                        <div class="alert-item-header">
                            <div class="alert-item-title">
                                <i class="fas fa-bell"></i>
                                ${alerta.titulo}
                            </div>
                            <div class="alert-item-time">${tempoAtras}</div>
                        </div>
                        <div class="alert-item-body">
                            <div class="alert-mudanca-status">
                                <i class="fas fa-sync-alt"></i>
                                Status alterado em <strong>${alerta.tarefaNome}</strong>
                            </div>
                            ${alerta.responsavel ? `<div class="alert-responsavel"><i class="fas fa-user"></i> ${alerta.responsavel}</div>` : ''}
                        </div>
                        <div class="alert-item-details">
                            <div class="alert-status-change">
                                <div class="status-change-label">De:</div>
                                <span class="alert-status-badge badge-de ${normalizarStatusParaClasse(alerta.statusAntigo)}">
                                    ${getLabelStatus(alerta.statusAntigo)}
                                </span>
                                <div class="status-change-label">Para:</div>
                                <span class="alert-status-badge badge-para ${normalizarStatusParaClasse(alerta.statusNovo)}">
                                    ${getLabelStatus(alerta.statusNovo)}
                                </span>
                            </div>
                        </div>
                        <div class="alert-actions">
                            <button class="btn-mark-read" onclick="marcarAlertaComoLido('${alerta.id}', 'observador')">
                                <i class="fas fa-check-circle"></i> Marcar como Lido
                            </button>
                            <button class="btn-go-to-activity" onclick="irParaAtividade('${alerta.atividadeId}')">
                                <i class="fas fa-external-link-alt"></i> Ver Atividade
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = alertasHTML;
        }
        
        // Fun√ß√£o para abrir dropdown de alertas de respons√°vel
        function abrirAlertasResponsavel() {
            const container = document.getElementById('responsavelAlertsContainer');
            const otherContainers = document.querySelectorAll('.alerts-container.show');
            
            // Fechar outros dropdowns
            otherContainers.forEach(other => {
                if (other !== container) {
                    other.classList.remove('show');
                }
            });
            
            // Alternar este dropdown
            container.classList.toggle('show');
            
            // Renderizar alertas REAIS
            renderizarAlertasResponsavel();
        }
        
        // Fun√ß√£o para renderizar alertas de respons√°vel
        function renderizarAlertasResponsavel() {
            const container = document.getElementById('responsavelAlertList');
            
            if (alertasResponsavel.length === 0) {
                container.innerHTML = '<div class="no-alerts">Nenhuma atividade pendente</div>';
                return;
            }
            
            const alertasHTML = alertasResponsavel.map(alerta => {
                const tempoAtras = formatarTempoAtras(alerta.dataCriacao);
                const dataPrevista = alerta.dataPrevista ? 
                    `<div class="alert-data-prevista">
                        <i class="fas fa-calendar"></i>
                        ${formatarData(alerta.dataPrevista)}
                    </div>` : 
                    '';
                
                return `
                    <div class="alert-item unread" data-alerta-id="${alerta.id}">
                        <div class="alert-item-header">
                            <div class="alert-item-title">
                                <i class="fas fa-user-check"></i>
                                ${alerta.titulo}
                            </div>
                            <div class="alert-item-time">${tempoAtras}</div>
                        </div>
                        <div class="alert-item-body">
                            <strong>${alerta.tarefaNome}</strong>
                            ${alerta.descricao ? `<p class="alert-descricao">${alerta.descricao}</p>` : ''}
                        </div>
                        <div class="alert-item-details">
                            <span class="badge alert-status-badge status-pendente">PENDENTE</span>
                            ${dataPrevista}
                        </div>
                        <div class="alert-actions">
                            <button class="btn-go-to-activity" onclick="irParaAtividade('${alerta.atividadeId}')">
                                <i class="fas fa-external-link-alt"></i> Ver Atividade
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = alertasHTML;
        }
        
        // Fun√ß√£o para marcar alerta como lido
        async function marcarAlertaComoLido(alertaId, tipo) {
            try {
                if (tipo === 'observador') {
                    // Encontrar o alerta
                    const alerta = alertasObservador.find(a => a.id === alertaId);
                    
                    if (alerta) {
                        // Buscar a atividade no Firestore
                        const atividadeDoc = await window.db.collection('atividades').doc(alerta.atividadeId).get();
                        
                        if (atividadeDoc.exists) {
                            const atividade = atividadeDoc.data();
                            const observadores = atividade.observadores || [];
                            
                            // Remover asterisco do observador espec√≠fico
                            const observadoresAtualizados = observadores.map(obs => {
                                if (obs === alerta.observador + '*') {
                                    return alerta.observador; // Remove o asterisco
                                }
                                return obs;
                            });
                            
                            // Atualizar no Firestore
                            await window.db.collection('atividades').doc(alerta.atividadeId).update({
                                observadores: observadoresAtualizados,
                                dataAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            
                            console.log(`‚úÖ Asterisco removido para ${alerta.observador} na atividade ${alerta.atividadeId}`);
                            
                            // Remover da lista local
                            alertasObservador = alertasObservador.filter(a => a.id !== alertaId);
                            
                            // Atualizar contadores
                            atualizarContadoresAlertas();
                        }
                    }
                } else {
                    // Para alertas de respons√°vel
                    alertasResponsavel = alertasResponsavel.filter(a => a.id !== alertaId);
                    atualizarContadoresAlertas();
                }
                
                // Re-renderizar lista
                if (tipo === 'observador') {
                    renderizarAlertasObservador();
                } else {
                    renderizarAlertasResponsavel();
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao marcar alerta como lido:', error);
            }
        }
        
        // Fun√ß√£o para ir para a atividade
        function irParaAtividade(atividadeId) {
            // Marcar como lido primeiro
            marcarAlertaComoLido(atividadeId, 'responsavel');
            
            // Abrir dashboard
            window.open(`dashboard.html?atividade=${atividadeId}`, '_blank');
        }
        
        // ====== FUN√á√ïES AUXILIARES ======
        
        // Fun√ß√£o para formatar tempo atr√°s
        function formatarTempoAtras(data) {
            const agora = new Date();
            const dataAlerta = new Date(data);
            const diferencaMinutos = Math.floor((agora - dataAlerta) / (1000 * 60));
            
            if (diferencaMinutos < 1) return 'Agora mesmo';
            if (diferencaMinutos < 60) return `${diferencaMinutos} min atr√°s`;
            
            const diferencaHoras = Math.floor(diferencaMinutos / 60);
            if (diferencaHoras < 24) return `${diferencaHoras} h atr√°s`;
            
            const diferencaDias = Math.floor(diferencaHoras / 24);
            return `${diferencaDias} d atr√°s`;
        }
        
        // Fun√ß√£o para formatar data
        function formatarData(dataString) {
            if (!dataString) return 'N√£o definida';
            return new Date(dataString + 'T00:00:00').toLocaleDateString('pt-BR');
        }
        
        // Fun√ß√£o para normalizar status para classe CSS
        function normalizarStatusParaClasse(status) {
            if (!status) return 'pendente';
            
            const statusNorm = status.toLowerCase().trim();
            
            switch(statusNorm) {
                case 'nao_iniciado':
                case 'n√£o iniciado':
                    return 'nao_iniciado';
                case 'pendente':
                    return 'pendente';
                case 'andamento':
                case 'em andamento':
                    return 'andamento';
                case 'concluido':
                case 'conclu√≠do':
                    return 'concluido';
                default:
                    return statusNorm.replace(/[^a-z0-9]/g, '_');
            }
        }
        
        // Fun√ß√£o para obter label do status
        function getLabelStatus(status) {
            if (!status) return 'N√£o Iniciado';
            
            const statusNorm = status.toLowerCase().trim();
            
            switch(statusNorm) {
                case 'nao_iniciado':
                case 'n√£o iniciado':
                    return 'N√£o Iniciado';
                case 'pendente':
                    return 'Pendente';
                case 'andamento':
                case 'em andamento':
                    return 'Em Andamento';
                case 'concluido':
                case 'conclu√≠do':
                    return 'Conclu√≠do';
                default:
                    return status.charAt(0).toUpperCase() + status.slice(1);
            }
        }
        
        // Fun√ß√£o para mostrar erro
        function mostrarErroTeste(mensagem) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                background: #dc3545;
                text-align: center;
            `;
            notification.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${mensagem}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 5000);
        }
        
        // Fun√ß√£o de logout
        function logout() {
            console.log('üö™ Fazendo logout...');
            localStorage.removeItem('usuarioLogado');
            window.location.href = 'login.html';
        }
        
        // Fechar dropdowns de alerta ao clicar fora
        document.addEventListener('click', function(event) {
            const containers = document.querySelectorAll('.alerts-container');
            let clickDentroDeAlerta = false;
            
            containers.forEach(container => {
                if (container.contains(event.target)) {
                    clickDentroDeAlerta = true;
                }
            });
            
            if (!clickDentroDeAlerta) {
                containers.forEach(container => {
                    container.classList.remove('show');
                });
            }
        });
        
        // Torna fun√ß√µes globais
        window.abrirAlertasObservador = abrirAlertasObservador;
        window.abrirAlertasResponsavel = abrirAlertasResponsavel;
        window.marcarAlertaComoLido = marcarAlertaComoLido;
        window.irParaAtividade = irParaAtividade;
        window.logout = logout;
        
    </script>
</body>
</html>
